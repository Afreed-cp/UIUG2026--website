---
import { fetchSiteSettings } from '../lib/umbraco';

// Fetch Site Settings for header data
let siteSettings = null;
try {
  siteSettings = await fetchSiteSettings();
} catch (error) {
  console.error('Error fetching site settings:', error);
}

const siteName = siteSettings?.properties?.siteName;
const navigationItems = siteSettings?.properties?.navigationItems;
const joinClusterUrl = siteSettings?.properties?.joinClusterUrl;


// Parse Multi URL Picker - can be array or object
function parseNavigationItems(items: any): Array<{ name: string; url: string; target?: string }> {
  if (!items) return [];
  if (Array.isArray(items)) {
    return items.map(item => ({
      name: item.name || item.title,
      url: item.url || item.link,
      target: item.target,
    })).filter(item => item.name && item.url);
  }
  // If it's a single object
  const parsed = {
    name: items.name || items.title,
    url: items.url || items.link,
    target: items.target,
  };
  return parsed.name && parsed.url ? [parsed] : [];
}

// Parse URL Picker - can be array (Multi URL Picker) or single object
function parseUrlPicker(picker: any): { name: string; url: string } | null {
  if (!picker) return null;
  
  // If it's an array (Multi URL Picker), take the first item
  if (Array.isArray(picker)) {
    if (picker.length === 0) return null;
    const item = picker[0];
    const name = item.name || item.title;
    const url = item.url || item.link;
    return name && url ? { name, url } : null;
  }
  
  // If it's a string
  if (typeof picker === 'string') {
    return { name: '', url: picker };
  }
  
  // If it's a single object
  const name = picker.name || picker.title;
  const url = picker.url || picker.link;
  return name && url ? { name, url } : null;
}

const navItems = parseNavigationItems(navigationItems);
const joinButton = parseUrlPicker(joinClusterUrl);

---

<header class="fixed top-0 w-full z-50 bg-terminal-black border-b border-terminal-gray h-12 flex items-center justify-between px-4">
  <div class="flex items-center gap-4">
    <span class="font-bold text-sm tracking-normal">{siteName}</span>
  </div>
  <nav class="hidden md:flex gap-8">
    {navItems.length > 0 && navItems.map((item) => (
      <a 
        class="hover:text-terminal-red transition-colors" 
        href={item.url}
        target={item.target}
      >
        {item.name}
      </a>
    ))}
    {joinButton && (
      <a 
        class="text-terminal-red font-bold hover:opacity-80 transition-opacity" 
        href={joinButton.url}
      >
        {joinButton.name}
      </a>
    )}
  </nav>
</header>

